<!DOCTYPE html>
<html>
<head>
    <title>Bearer Token Reader</title>
</head>
<body>
    <script>
        function decodeJWT(token) {
            try {
                const parts = token.split('.');
                
                if (parts.length !== 3) {
                    throw new Error('Invalid JWT format - expected 3 parts separated by dots');
                }
                
                // Add padding for proper base64 decoding
                function addPadding(str) {
                    return str + '='.repeat((4 - str.length % 4) % 4);
                }
                
                // Decode header and payload
                const header = JSON.parse(atob(addPadding(parts[0].replace(/-/g, '+').replace(/_/g, '/'))));
                const payload = JSON.parse(atob(addPadding(parts[1].replace(/-/g, '+').replace(/_/g, '/'))));
                
                return {
                    header: header,
                    payload: payload,
                    signature: parts[2]
                };
            } catch (error) {
                // Return error details for debugging
                return { 
                    error: true,
                    message: error.message,
                    raw_token: token.substring(0, 50) + '...' // Show first 50 chars for debugging
                };
            }
        }
        
        function getBearerTokenFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const bearerToken = urlParams.get('bearer');
            
            let result;
            
            if (bearerToken) {
                result = decodeJWT(bearerToken);
            } else {
                result = {
                    error: true,
                    message: "No bearer token provided",
                    usage: "Add ?bearer=your_jwt_token to the URL",
                    examples: [
                        "?bearer=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                        "?bearer=your_jwt_token&format=json (for raw JSON output)"
                    ]
                };
            }
            
            // Support different output formats for API testing
            if (urlParams.get('format') === 'json') {
                // Raw JSON output (better for API testing)
                document.body.innerHTML = JSON.stringify(result);
                document.body.style.fontFamily = 'monospace';
                document.body.style.whiteSpace = 'pre';
            } else {
                // Pretty formatted output (better for human reading)
                document.body.innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            }
        }
        
        window.addEventListener('load', getBearerTokenFromURL);
    </script>
</body>
</html>